---
layout: post
title: CRM Online Entity Creation
date: 2013-04-30 14:42:11.000000000 +05:00
type: post
published: true
status: publish
categories:
- Dynamics CRM
tags: []
meta:
  _wpas_done_1982054: '1'
  _publicize_done_external: a:1:{s:8:"linkedin";a:1:{s:10:"9w6qkgZkkl";b:1;}}
  _oembed_e34e56d4044bc639612bbcbad8ffa6cb: '{{unknown}}'
author:
  login: zamd
  email: zulfiqar.ahmed@gmail.com
  display_name: zamd
  first_name: ''
  last_name: ''
---
<p>Recently I started exploring the world of Dynamics and specifically Dynamics CRM. Technically the platform looks fairly simple with a reasonably clean web services API (mostly SOAP) &amp; SAML based message security (remember <em>legacy</em> WS-Trust :)) using Live ID as the identity provider.</p>
<p>The helper code from the sdk (\sdk\samplecode\cs\helpercode) hides all the complexity but the under the hood following flow happens to interact with Dynamics Online Web Services. </p>
<p><a href="http://zuahmed.files.wordpress.com/2013/04/image.png"><img title="image" style="border-top:0;border-right:0;border-bottom:0;border-left:0;display:inline;" border="0" alt="image" src="{{ site.baseurl }}/assets/image_thumb.png" width="244" height="123" /></a> </p>
<p>Following is small console application I used to create a new lead into CRM Online.</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:1a3a86f1-f07a-4f89-a3bc-b275b18b4a99" class="wlWriterEditableSmartContent" style="float:none;margin:0;display:inline;padding:0;">
<div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;">
<div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div>
<div style="background-color:#ffffff;max-height:300px;overflow:auto;padding:2px 5px;">    <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">var</span><span style="background:#ffffff;color:#000000;"> connection =</span><br />         <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#2b91af;">CrmConnection</span><span style="background:#ffffff;color:#000000;">.Parse(</span><span style="background:#ffffff;color:#a31515;">&quot;Url=https://psfd365.crm4.dynamics.com; User ID=zamd@psfd365.onmicrosoft.com; Password=*password*;&quot;</span><span style="background:#ffffff;color:#000000;">);</span><br />     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">var</span><span style="background:#ffffff;color:#000000;"> organization = </span><span style="background:#ffffff;color:#0000ff;">new</span><span style="background:#ffffff;color:#000000;"> </span><span style="background:#ffffff;color:#2b91af;">OrganizationService</span><span style="background:#ffffff;color:#000000;">(connection);</span></p>
<p>     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">var</span><span style="background:#ffffff;color:#000000;"> who = organization.Execute(</span><span style="background:#ffffff;color:#0000ff;">new</span><span style="background:#ffffff;color:#000000;"> </span><span style="background:#ffffff;color:#2b91af;">WhoAmIRequest</span><span style="background:#ffffff;color:#000000;">()) </span><span style="background:#ffffff;color:#0000ff;">as</span><span style="background:#ffffff;color:#000000;"> </span><span style="background:#ffffff;color:#2b91af;">WhoAmIResponse</span><span style="background:#ffffff;color:#000000;">;</span><br />     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#2b91af;">Console</span><span style="background:#ffffff;color:#000000;">.WriteLine(</span><span style="background:#ffffff;color:#a31515;">&quot;{</span><span style="background:#ffffff;color:#3cb371;">0}</span><span style="background:#ffffff;color:#a31515;">@{</span><span style="background:#ffffff;color:#3cb371;">1}</span><span style="background:#ffffff;color:#a31515;">&quot;</span><span style="background:#ffffff;color:#000000;">, who.UserId, who.OrganizationId);</span><br />     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">var</span><span style="background:#ffffff;color:#000000;"> user = </span><br />     <span style="background:#ffffff;color:#000000;">organization.Retrieve(</span><span style="background:#ffffff;color:#a31515;">&quot;systemuser&quot;</span><span style="background:#ffffff;color:#000000;">, who.UserId,</span><br />                           <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">new</span><span style="background:#ffffff;color:#000000;"> </span><span style="background:#ffffff;color:#2b91af;">ColumnSet</span><span style="background:#ffffff;color:#000000;">(</span><span style="background:#ffffff;color:#0000ff;">new</span><span style="background:#ffffff;color:#000000;">[] {</span><span style="background:#ffffff;color:#a31515;">&quot;firstname&quot;</span><span style="background:#ffffff;color:#000000;">, </span><span style="background:#ffffff;color:#a31515;">&quot;lastname&quot;}</span><span style="background:#ffffff;color:#000000;">)) </span><span style="background:#ffffff;color:#0000ff;">as</span><span style="background:#ffffff;color:#000000;"> </span><span style="background:#ffffff;color:#2b91af;">SystemUser</span><span style="background:#ffffff;color:#000000;">;</span></p>
<p>     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#2b91af;">Console</span><span style="background:#ffffff;color:#000000;">.WriteLine(</span><span style="background:#ffffff;color:#a31515;">&quot;creating lead...&quot;</span><span style="background:#ffffff;color:#000000;">);</span></p>
<p>     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">var</span><span style="background:#ffffff;color:#000000;"> newLead = </span><span style="background:#ffffff;color:#0000ff;">new</span><span style="background:#ffffff;color:#000000;"> </span><span style="background:#ffffff;color:#2b91af;">Lead</span><br />                        <span style="background:#ffffff;color:#000000;">{</span><br />                            <span style="background:#ffffff;color:#000000;">Subject = </span><span style="background:#ffffff;color:#a31515;">&quot;Interested in dyanamics crm...&quot;</span><span style="background:#ffffff;color:#000000;">,</span><br />                            <span style="background:#ffffff;color:#000000;">FirstName = user.FirstName,</span><br />                            <span style="background:#ffffff;color:#000000;">LastName = user.LastName,</span><br />                            <span style="background:#ffffff;color:#000000;">MobilePhone = </span><span style="background:#ffffff;color:#a31515;">&quot;004412123231212&quot;</span><br />                        <span style="background:#ffffff;color:#000000;">};</span></p>
<p>     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#0000ff;">var</span><span style="background:#ffffff;color:#000000;"> leadId = organization.Create(newLead);</span><br />     <span style="background:#ffffff;color:#000000;"></span><span style="background:#ffffff;color:#2b91af;">Console</span><span style="background:#ffffff;color:#000000;">.WriteLine(</span><span style="background:#ffffff;color:#a31515;">&quot;New lead {</span><span style="background:#ffffff;color:#3cb371;">0}</span><span style="background:#ffffff;color:#a31515;"> created.&quot;</span><span style="background:#ffffff;color:#000000;">,leadId);</span><br /> <span style="background:#ffffff;color:#000000;">}</span></div>
</p></div>
</p></div></p>
<p>that’s it – you can see the new lead created below. </p>
<p><a href="http://zuahmed.files.wordpress.com/2013/04/image1.png"><img title="image" style="border-top:0;border-right:0;border-bottom:0;border-left:0;display:inline;" border="0" alt="image" src="{{ site.baseurl }}/assets/image_thumb1.png" width="244" height="132" /></a></p>
