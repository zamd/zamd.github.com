---
layout: post
title: 'Part3: Explicit ACS federation'
date: 2009-02-04 17:48:25.000000000 +05:00
type: post
published: true
status: publish
categories:
- .NET Services
tags: []
meta:
  _oembed_e168525c5711563811ef5625463cac76: '{{unknown}}'
  _oembed_49f037572bede8ab79746a3df13d478a: '{{unknown}}'
  _oembed_2c58d793c9dca5999e3fff1819036f58: '{{unknown}}'
  _oembed_1769f2c23d6d3120874b9a72e8db2e0c: '{{unknown}}'
  _oembed_5f11243cdedb7b7faa5a497f8388cce8: '{{unknown}}'
  _oembed_ecf431b6b91c2bd9bac543f7ab405d63: '{{unknown}}'
  _oembed_bebf3d740bb3c6a07e98ba30215462e2: '{{unknown}}'
  _oembed_a1722cb775bb8d5b29a3d12650ce9e35: '{{unknown}}'
  _oembed_34a129e6b6a93a392104c294961ce4dd: '{{unknown}}'
  _oembed_9ee4013182f7159e637e6930a066f24f: '{{unknown}}'
  _oembed_4e6259e73847aa81743ebf0b50ddf79c: '{{unknown}}'
  _oembed_b98adcb34889c1d2882367d696cd2e18: '{{unknown}}'
  _oembed_8566c707cb7b15542b1cc80aa73c327d: '{{unknown}}'
  _oembed_c3834563ac7a464f52005b7f4f5bf8b5: '{{unknown}}'
author:
  login: zamd
  email: zulfiqar.ahmed@gmail.com
  display_name: zamd
  first_name: ''
  last_name: ''
---
<div class="Section1">
<p class="MsoNormal">In <a href="http://www.zamd.net/2009/01/23/Part2ACSFederationWithCustomSTS.aspx">last post</a>, I have shown you how to federate ACS with a custom STS. All the token acquisition (from my local STS) and forwarding (to ACS) magic was done by <a href="http://msdn.microsoft.com/en-us/library/system.servicemodel.wsfederationhttpbinding.aspx">WSFederationHttpBinding</a> and you never see the intermediate token (issued by your local STS). There are scenarios where you want more explicit control over this intermediate token. In this post I will show some techniques to get hold of this intermediate token and thus control its lifetime &amp; forwarding etc. </p>
<p class="MsoNormal"><b>Step 1</b>: Get the token from our local STS.</p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">private</span><span style="font-size:10pt;font-family:\"Courier New\";"> <span style="color:blue;">static</span> <span style="color:#2B91AF;">SecurityToken</span> GetTokenFromLocalSTS()</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">{</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> localSTSBinding = <span style="color:blue;">new</span> <span style="color:#2B91AF;">WSHttpBinding</span>(<span style="color:#A31515;">&quot;AnnonyForCertificate&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:green;">//only public key cert. use to secure communication.</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> localSTSCert = <span style="color:blue;">new</span> <span style="color:#2B91AF;">X509Certificate2</span>(<span style="color:#A31515;">@&quot;MyCustomSTSPublicKey.cer&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> localSTSIdentity = <span style="color:blue;">new</span> <span style="color:#2B91AF;">X509CertificateEndpointIdentity</span>(localSTSCert);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> localSTSAddress = <span style="color:blue;">new</span> <span style="color:#2B91AF;">EndpointAddress</span>(<span style="color:blue;">new</span> <span style="color:#2B91AF;">Uri</span>(<span style="color:#A31515;">&quot;http://localhost:9000/STS&quot;</span>), localSTSIdentity);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:#2B91AF;">WSTrustClient</span> client = <span style="color:blue;">new</span> <span style="color:#2B91AF;">WSTrustClient</span>(localSTSBinding, localSTSAddress,<span style="color:#2B91AF;">TrustVersion</span>.WSTrustFeb2005, <span style="color:blue;">new</span> <span style="color:#2B91AF;">ClientCredentials</span>());</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:#2B91AF;">RequestSecurityToken</span> rst = <span style="color:blue;">new</span> <span style="color:#2B91AF;">RequestSecurityToken</span>(<span style="color:#2B91AF;">RequestTypeConstants</span>.Issue);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; rst.AppliesTo = <span style="color:blue;">new</span> <span style="color:#2B91AF;">EndpointAddress</span>(<span style="color:#A31515;">&quot;http://accesscontrol.windows.net/sts/eval01/saml for certificate/&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; </span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:#2B91AF;">RequestSecurityTokenResponse</span> rstr;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> token = client.Issue(rst, <span style="color:blue;">out</span> rstr);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; client.Close();</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">return</span> token;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">}</span></p>
<p class="MsoNormal">My local STS is configured to issue token to all annonymous callers. Here is the binding:</p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">binding</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">name</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">AnnonyForCertificate</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">security</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">mode</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">Message</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">message</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">clientCredentialType</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">None</span>&quot;<span style="color:blue;"> </span><span style="color:red;">negotiateServiceCredential</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">false</span>&quot;<span style="color:blue;"> </span><span style="color:red;">establishSecurityContext</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">false</span>&quot;<span style="color:blue;">/&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">security</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">binding</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><b>Step 2</b>: Forward this token to ACS along with Issue request.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">private</span><span style="font-size:10pt;font-family:\"Courier New\";"> <span style="color:blue;">static</span> <span style="color:blue;">void</span> FederateMyCustomSTS With ACS()</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">{</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;background:yellow;">var</span><span style="background:yellow;"> intermediateToken = GetTokenFromLocalSTS();</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:green;">// we got token from my our local STS. Forward this token to ACS with Issue request</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> acsCert = GetACSCertificate();</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> acsIdentity = <span style="color:blue;">new</span> <span style="color:#2B91AF;">X509CertificateEndpointIdentity</span>(acsCert);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> acsAddress = <span style="color:blue;">new</span> <span style="color:#2B91AF;">EndpointAddress</span>(<span style="color:blue;">new</span> <span style="color:#2B91AF;">Uri</span>(<span style="color:#A31515;">&quot;http://accesscontrol.windows.net/sts/eval01/saml for certificate&quot;</span>), acsIdentity);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> acsBinding = <span style="color:blue;">new</span> <span style="color:#2B91AF;">CustomBinding</span>(<span style="color:#A31515;">&quot;AnySamlForCertificate&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> acsClient = <span style="color:blue;">new</span> <span style="color:#2B91AF;">WSTrustClient</span>(acsBinding, acsAddress, <span style="color:#2B91AF;">TrustVersion</span>.WSTrust13, <span style="color:blue;">new</span> <span style="color:#2B91AF;">ClientCredentials</span>());</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; acsClient = acsClient.SetIssuedToken(intermediateToken);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:#2B91AF;">RequestSecurityToken</span> rstACS = <span style="color:blue;">new</span> <span style="color:#2B91AF;">RequestSecurityToken</span>(<span style="color:#2B91AF;">RequestTypeConstants</span>.Issue);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; rstACS.AppliesTo = <span style="color:blue;">new</span> <span style="color:#2B91AF;">EndpointAddress</span>(<span style="color:#A31515;">&quot;http://zamd.net/&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp; &nbsp;<span style="color:blue;">var</span> finalToken = acsClient.Issue(rstACS) <span style="color:blue;">as</span> <span style="color:#2B91AF;">GenericXmlSecurityToken</span>;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:green;">// dump SAML.</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> rpCert = <span style="color:blue;">new</span> <span style="color:#2B91AF;">X509Certificate2</span>(<span style="color:#A31515;">@&quot;zamdnetprivatekeycert.pfx&quot;</span>, <span style="color:#A31515;">&quot;a&quot;</span>);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">&nbsp;&nbsp;&nbsp; <span style="color:blue;">var</span> saml = ExtractSAMLAssertion(finalToken, rpCert);</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";">}</span></p>
<p class="MsoNormal">The ACS binding is as follows:</p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">binding</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">name</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">AnySamlForCertificate</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">security</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">authenticationMode</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">IssuedTokenForCertificate</span>&quot;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">messageSecurityVersion</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">WSSecurity11WSTrust13WSSecureConversation13WSSecurityPolicy12BasicSecurityProfile10</span>&quot;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">requireSignatureConfirmation</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">false</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">issuedTokenParameters</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">issuer</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">address</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">http://dummy</span>&quot;<span style="color:blue;"> </span><span style="color:red;">binding</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">basicHttpBinding</span>&quot;<span style="color:blue;">/&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">issuedTokenParameters</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">security</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">httpTransport</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">/&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">binding</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal">With the above code I get back following SAML assertion (containing only one claim).</p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:AttributeStatement</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">xmlns:saml</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">urn:oasis:names:tc:SAML:1.0:assertion</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:Subject</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:SubjectConfirmation</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:ConfirmationMethod</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span><span style="font-size:10pt;font-family:\"Courier New\";">urn:oasis:names:tc:SAML:1.0:cm:holder-of-key<span style="color:blue;">&lt;/</span><span style="color:#A31515;">saml:ConfirmationMethod</span><span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">KeyInfo</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">xmlns</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">http://www.w3.org/2000/09/xmldsig#</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:EncryptedKey</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">xmlns:e</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">http://www.w3.org/2001/04/xmlenc#</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:EncryptionMethod</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">Algorithm</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">DigestMethod</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">Algorithm</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">http://www.w3.org/2000/09/xmldsig#sha1</span>&quot;<span style="color:blue;"> /&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:EncryptionMethod</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">KeyInfo</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">o:SecurityTokenReference</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">xmlns:o</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">X509Data</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">X509IssuerSerial</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">X509IssuerName</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span><span style="font-size:10pt;font-family:\"Courier New\";">CN=Root Agency<span style="color:blue;">&lt;/</span><span style="color:#A31515;">X509IssuerName</span><span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">X509SerialNumber</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span><span style="font-size:10pt;font-family:\"Courier New\";">53391460269745460375752793295988585963<span style="color:blue;">&lt;/</span><span style="color:#A31515;">X509SerialNumber</span><span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">X509IssuerSerial</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">X509Data</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">o:SecurityTokenReference</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">KeyInfo</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:CipherData</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:CipherValue</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span><span style="font-size:10pt;font-family:\"Courier New\";">laW9NYJ3NHh+M3c6U1Nq/FADoAWsVc2/JZHYIHJ/qWF536ecpA12NI5orlyvzJ9D+gAK98ZsyouHm1rvQPrttpATQtilrkkyvwKK6JRQb4Ji9th8QGxA+9Yc8yKXlS+rn+lQhdGjYwH8PVxb38IlyJFydtJDMtsJID1OiXagp/w=<span style="color:blue;">&lt;/</span><span style="color:#A31515;">e:CipherValue</span><span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:CipherData</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">e:EncryptedKey</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">KeyInfo</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:SubjectConfirmation</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:Subject</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:Attribute</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"> </span><span style="font-size:10pt;font-family:\"Courier New\";color:red;">AttributeName</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">=</span><span style="font-size:10pt;font-family:\"Courier New\";">&quot;<span style="color:blue;">action</span>&quot;<span style="color:blue;"> </span><span style="color:red;">AttributeNamespace</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://docs.oasis-open.org/wsfed/authorization/200706/claims</span>&quot;<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp;&nbsp;&nbsp; <span style="background:yellow;">&lt;</span></span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;background:yellow;">saml:AttributeValue</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;background:yellow;">&gt;</span><span style="font-size:10pt;font-family:\"Courier New\";background:yellow;">that's done<span style="color:blue;">&lt;/</span><span style="color:#A31515;">saml:AttributeValue</span><span style="color:blue;">&gt;</span></span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;"></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&nbsp; &lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:Attribute</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&lt;/</span><span style="font-size:10pt;font-family:\"Courier New\";color:#A31515;">saml:AttributeStatement</span><span style="font-size:10pt;font-family:\"Courier New\";color:blue;">&gt;</span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">I hope you will find this post useful. In the next post, I will show how to federate ACS with Geneva Server. &nbsp;Stay tuned...<span style="font-size:10pt;font-family:\"Courier New\";color:blue;"></span></p>
</p></div>
