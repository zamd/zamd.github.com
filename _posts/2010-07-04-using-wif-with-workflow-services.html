---
layout: post
title: Using WIF with Workflow Services
date: 2010-07-04 15:18:55.000000000 +05:00
type: post
published: true
status: publish
categories:
- WF4
- WFSP
tags: []
meta:
  _edit_last: '13661190'
  _oembed_58df07cb43ec65dc7686bbb68d3043c0: '{{unknown}}'
  _oembed_bb29dd3c02866fd59aa33f0f7d6e3037: '{{unknown}}'
  _oembed_f82ca91250e7c419396e18ca856405a7: '{{unknown}}'
  _oembed_8eb0f711788bceb1799256f9fbbe26ce: '{{unknown}}'
  _oembed_f4ef2d6da43a012c9b52977e88af1fa4: '{{unknown}}'
  _oembed_c910e548fdc498c2d5e5603b92c56799: '{{unknown}}'
  _oembed_6745c96f8e781a91f78f0e830b83b84d: '{{unknown}}'
  _oembed_0f4c1a3bd49a69a59d9827340b560f09: '{{unknown}}'
  _oembed_167e223e84ebc1d2fa1814859e947a4a: '{{unknown}}'
  _oembed_30af9ab09ee8cdd3fa2e38a9fe8a9d6d: '{{unknown}}'
  _oembed_a4371e73b1a1688c456ea600db461aad: '{{unknown}}'
  _oembed_82164d91d6dec87b8eaee644044fecbb: '{{unknown}}'
  _oembed_c41300e34c9338e5d5e88306ff9419b7: '{{unknown}}'
  _oembed_9b4c6be1180ac149915839aa9a6b4ebb: '{{unknown}}'
  _oembed_c5c4c2f0d1e546c97931c4d0508220c0: '{{unknown}}'
  _oembed_1583b02e42c4d851b83486b8cf8ef52f: '{{unknown}}'
  _oembed_75b34d50523e0968bc963b4e4dcecfe7: '{{unknown}}'
author:
  login: zamd
  email: zulfiqar.ahmed@gmail.com
  display_name: zamd
  first_name: ''
  last_name: ''
---
<p><a href="http://msdn.microsoft.com/en-us/library/ee748484.aspx">Windows Identity Foundation</a> integrates with WCF at the host level (ServiceHost) and then various WIF extensibility points are invoked at different stages of WCF message processing pipeline. In this post, I will show how WIF can be integrated with Workflow Services to enable common security scenarios. Additional rich security scenarios can also be enabled by using activities which are currently part of <a href="http://wf.codeplex.com/releases/view/48114">WF Security Pack</a> project. </p>
<h3>Basic Walkthrough</h3>
<p>Create a new WCF Workflow Service Application by choosing File -&gt; New Project:</p>
<p><a href="http://zuahmed.files.wordpress.com/2010/07/clip_image0024.jpg"><img style="display:inline;border-width:0;" title="clip_image002[4]" border="0" alt="clip_image002[4]" src="{{ site.baseurl }}/assets/clip_image0024_thumb.jpg" width="254" height="180" /></a></p>
<p>You would notice generated web.config is using simplified WCF 4.0 configuration. There are no explicit endpoint definitions rather service would get default endpoints at runtime.</p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">system.serviceModel</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">behaviors</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceBehaviors</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">behavior</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;"> To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment </span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceMetadata</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">httpGetEnabled</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">/&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;"> To receive exception details in faults for debugging purposes, set the value below to true.<span>&#160; </span>Set to false before deployment to avoid disclosing exception information </span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceDebug</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">includeExceptionDetailInFaults</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">false</span>&quot;<span style="color:blue;">/&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">behavior</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceBehaviors</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">behaviors</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceHostingEnvironment</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">multipleSiteBindingsEnabled</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">system.serviceModel</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>A workflow service is a standard WCF service whose implementation is a workflow, so we should be able to integrate WIF using exactly the same techniques we know for code based WCF services. </p>
<h3>Externalize the authentication to an STS</h3>
<p>Inside Solution Explorer, right click on your workflow service project and select “Add STS Reference” option to launch FedUtil.exe. </p>
<p>On the Welcome Page, specify the Application URI and click next. On Security Token Service Page, select “Use an existing STS” option and specify the URL of the WS-Federation metadata document. For this example, I’m using AD FS 2.0 as the existing STS. </p>
<p><a href="http://zuahmed.files.wordpress.com/2010/07/clip_image0026.jpg"><img style="display:inline;border-width:0;" title="clip_image002[6]" border="0" alt="clip_image002[6]" src="{{ site.baseurl }}/assets/clip_image0026_thumb.jpg" width="244" height="184" /></a></p>
<p>Leave the default value “Disable certificate chain validation” on next page as I’m using self-signed certificates. </p>
<p>On the “Security token encryption”, choose “Enable encryption” option and specify the private key certificate of your service.</p></p>
<p><a href="http://zuahmed.files.wordpress.com/2010/07/clip_image0028.jpg"><img style="display:inline;border-width:0;" title="clip_image002[8]" border="0" alt="clip_image002[8]" src="{{ site.baseurl }}/assets/clip_image0028_thumb.jpg" width="244" height="184" /></a></p>
<p>Finish the wizard by choosing default values for the next two pages. </p>
<p>Wizard would generate all the configuration required to enable WIF on this Workflow Service. Lets briefly examine the generated configuration:</p>
<p>A new WIF related section is registered…</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">configSections</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">section</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">name</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">microsoft.identityModel</span>&quot;<span style="color:blue;"> </span><span style="color:red;">type</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Microsoft.IdentityModel.Configuration.MicrosoftIdentityModelSection, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">configSections</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><strong>&lt;microsoft.IdentityModel&gt;</strong> configuration section is generated to externalize the authentication responsibility for this service to AD FS 2.0. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">microsoft.identityModel</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">service</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">audienceUris</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;background:yellow;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;background:yellow;color:red;font-size:9.5pt;">value</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;background:yellow;font-size:9.5pt;">&quot;<span style="color:blue;">http://localhost:2534/Service1.xamlx</span>&quot;<span style="color:blue;"> /&gt;</span></span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">audienceUris</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">issuerNameRegistry</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">type</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">Microsoft.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35</span>&quot;<span style="color:blue;">&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">trustedIssuers</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">thumbprint</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">A1D6790E1CD8EAF2A23768E5789805E1AE58C9D6</span>&quot;<span style="color:blue;"> </span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://ids.bccoss.com/adfs/services/trust</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">trustedIssuers</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">issuerNameRegistry</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">certificateValidation</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">certificateValidationMode</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">None</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">service</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">microsoft.identityModel</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p>&#160;</p>
<p>A new Service Behaviour is added to the default behaviour collection, which configures WIF on this Workflow Service at the host level (WorkflowServiceHost in this case)</p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceBehaviors</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">behavior</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="background:yellow;">&lt;</span></span><span style="font-family:consolas;background:yellow;color:#a31515;font-size:9.5pt;">federatedServiceHostConfiguration</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;"> /&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;"> To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment </span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceMetadata</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">httpGetEnabled</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;"> To receive exception details in faults for debugging purposes, set the value below to true.<span>&#160; </span>Set to false before deployment to avoid disclosing exception information </span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceDebug</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">includeExceptionDetailInFaults</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">false</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceCredentials</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">Certificate added by FedUtil.<span>&#160; </span>Subject='CN=SampleService', Issuer='CN=Root Agency'.</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceCertificate</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">findValue</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">F042616A35AD30BE5069B468A67FF1233824F5F1</span>&quot;<span style="color:blue;"> </span><span style="color:red;">storeLocation</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">LocalMachine</span>&quot;<span style="color:blue;"> </span><span style="color:red;">storeName</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">My</span>&quot;<span style="color:blue;"> </span><span style="color:red;">x509FindType</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">FindByThumbprint</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceCredentials</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">behavior</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">serviceBehaviors</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p>&#160;</p>
<p>Default binding for the http scheme is changed to a wizard generated wsFederationHttpBinding. This enables all http based default endpoints to be configured to use this wsFederationHttpBinding.</p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">protocolMapping</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span><span style="background:yellow;">&lt;</span></span><span style="font-family:consolas;background:yellow;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;background:yellow;color:red;font-size:9.5pt;">scheme</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;background:yellow;font-size:9.5pt;">&quot;<span style="color:blue;">http</span>&quot;<span style="color:blue;"> </span><span style="color:red;">binding</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">ws2007FederationHttpBinding</span>&quot;<span style="color:blue;"> /&gt;</span></span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">protocolMapping</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>A new default configuration of ws2007FederationHttpBinding is also generated by the wizard based on the selection made in Wizard. This generated binding has an issuerMetadata element specifying the metadata URL of AD FS 2.0 which would be used by the clients to fetch all the endpoints supported by AD FS 2.0 </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">bindings</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">ws2007FederationHttpBinding</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">binding</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">security</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">mode</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">Message</span>&quot;<span style="color:blue;">&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">message</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">issuerMetadata</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">address</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">https://ids.bccoss.com/adfs/services/trust/mex</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">claimTypeRequirements</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">Following are the claims offered by STS 'http://ids.bccoss.com/adfs/services/trust'. Add or uncomment claims that you require by your application and then update the federation metadata of this application.</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">claimType</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name</span>&quot;<span style="color:blue;"> </span><span style="color:red;">isOptional</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">claimType</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">http://schemas.microsoft.com/ws/2008/06/identity/claims/role</span>&quot;<span style="color:blue;"> </span><span style="color:red;">isOptional</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/claims/CommonName&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/claims/EmailAddress&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/claims/Group&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/claims/UPN&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationinstant&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/denyonlysid&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarysid&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/denyonlyprimarygroupsid&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/primarygroupsid&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;!--</span><span style="font-family:consolas;color:green;font-size:9.5pt;">&lt;add claimType=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot; isOptional=&quot;true&quot; /&gt;</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">--&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">claimTypeRequirements</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">message</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">security</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">binding</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">ws2007FederationHttpBinding</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">bindings</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">That’s it. Your claim-aware Workflow Service is ready now. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>At this stage, clients can generate the required configuration by simply using “Add Service Reference” wizard which would generate config<span>&#160; </span>(endpoint addresses &amp; bindings) for all the different endpoints supported by AD FS 2.0. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>The main service endpoint would automatically be configured to acquire a token from AD FS 2.0 before calling the Workflow Service.<span>&#160; </span></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">As AD FS 2.0 supports multiple endpoints, generated wsFederationHttpBinding simply picks the first endpoint returned by the AD FS 2.0. This first endpoint choice might not be appropriate in all scenarios and you can easily change it in the client config file. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160; </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">client</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">endpoint</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">address</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">http://localhost:2534/Service1.xamlx</span>&quot;<span style="color:blue;"> </span><span style="color:red;">binding</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">customBinding</span>&quot; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span><span style="font-family:consolas;color:red;font-size:9.5pt;">bindingConfiguration</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">WS2007FederationHttpBinding_IService</span>&quot; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span></span><span style="font-family:consolas;color:red;font-size:9.5pt;">contract</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">ServiceReference1.IService</span>&quot;<span style="color:blue;"> </span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">WS2007FederationHttpBinding_IService</span>&quot;<span style="color:blue;">&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">identity</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">certificate</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">encodedValue</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">AwAAAAEAAAAUAAAAhxjyEc1MCXsA5XXteMRn0iyQBuwgAAAAAQAAALgBAAAwggG0MIIBYqADAgE==</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">identity</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">endpoint</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">client</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<h2>Claims Transformation</p>
</h2>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">ClaimsAuthenticationManager can be used to perform claims-transformation exactly in the same way as in code based service. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160; </span><span style="color:blue;">public</span> <span style="color:blue;">class</span> <span style="color:#2b91af;">SimpleClaimsAuthenticationManager</span>:<span style="color:#2b91af;">ClaimsAuthenticationManager</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>{ </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">public</span> <span style="color:blue;">override</span> <span style="color:#2b91af;">IClaimsPrincipal</span> Authenticate(<span style="color:blue;">string</span> resourceName, <span style="color:#2b91af;">IClaimsPrincipal</span> incomingPrincipal) </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{ </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:green;">// Claims transformation...</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">return</span> <span style="color:blue;">base</span>.Authenticate(resourceName, incomingPrincipal); </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>} </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>} </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">This class can then be configured on the workflow service using following configuration. All other config except the highlighted line was automatically generated by FedUtil.exe. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">service</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">audienceUris</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">value</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">http://localhost:2534/Service1.xamlx</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">audienceUris</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">issuerNameRegistry</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">type</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">Microsoft.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, Microsoft.IdentityModel, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35</span>&quot;<span style="color:blue;">&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">trustedIssuers</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">add</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">thumbprint</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">A1D6790E1CD8EAF2A23768E5789805E1AE58C9D6</span>&quot;<span style="color:blue;"> </span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://ids.bccoss.com/adfs/services/trust</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">trustedIssuers</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">issuerNameRegistry</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt;</span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span>&lt;</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">certificateValidation</span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;color:red;font-size:9.5pt;">certificateValidationMode</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;font-size:9.5pt;">&quot;<span style="color:blue;">None</span>&quot;<span style="color:blue;"> /&gt;</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span><span style="background:yellow;">&lt;</span></span><span style="font-family:consolas;background:yellow;color:#a31515;font-size:9.5pt;">claimsAuthenticationManager</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;background:yellow;color:red;font-size:9.5pt;">type</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;background:yellow;font-size:9.5pt;">&quot;<span style="color:blue;">DeclarativeServiceLibrary1.SimpleClaimsAuthenticationManager</span>&quot;<span style="color:blue;">/&gt;</span></span><span style="font-family:consolas;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>&lt;/</span><span style="font-family:consolas;color:#a31515;font-size:9.5pt;">service</span><span style="font-family:consolas;color:blue;font-size:9.5pt;">&gt; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<h2>Claims based Authorization</p>
</h2>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">Similarly Claim-Based-Authorization can be enforced at the host level using a ClaimsAuthorizationManager. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160; </span><span style="color:blue;">public</span> <span style="color:blue;">class</span> <span style="color:#2b91af;">SimpleClaimsAuthorizationManager</span>:<span style="color:#2b91af;">ClaimsAuthorizationManager</span> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>{ </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">public</span> <span style="color:blue;">override</span> <span style="color:blue;">bool</span> CheckAccess(<span style="color:#2b91af;">AuthorizationContext</span> context) </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{ </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">if</span> (((<span style="color:#2b91af;">IClaimsIdentity</span>)context.Principal.Identity).Claims.Where(c=&gt; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>c.ClaimType== <span style="color:#2b91af;">ClaimTypes</span>.Upn &amp;&amp; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>c.Value == <span style="color:#a31515;">&quot;zam1d@bccoss.com&quot;</span>).Count() ==0) </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">return</span> <span style="color:blue;">false</span>; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">return</span> <span style="color:blue;">true</span>; </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>} </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;font-size:9.5pt;"><span>&#160;&#160;&#160; </span>} </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"><span>&#160;&#160;&#160;&#160;&#160; </span><span style="background:yellow;">&lt;</span></span><span style="font-family:consolas;background:yellow;color:#a31515;font-size:9.5pt;">claimsAuthorizationManager</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;"> </span><span style="font-family:consolas;background:yellow;color:red;font-size:9.5pt;">type</span><span style="font-family:consolas;background:yellow;color:blue;font-size:9.5pt;">=</span><span style="font-family:consolas;background:yellow;font-size:9.5pt;">&quot;<span style="color:blue;">DeclarativeServiceLibrary1.SimpleClaimsAuthorizationManager</span>&quot;<span style="color:blue;">/&gt;</span></span><span style="font-family:consolas;color:blue;font-size:9.5pt;"> </span></p></p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">With above authorization manager plugged in, you can verify client is failing with “Access is denied” error. </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal">
<p>&#160;</p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span><a href="http://zuahmed.files.wordpress.com/2010/07/clip_image0021.jpg"><img style="display:inline;border-width:0;" title="clip_image002" border="0" alt="clip_image002" src="{{ site.baseurl }}/assets/clip_image002_thumb1.jpg" width="559" height="104" /></a></span> </p></p>
<p style="line-height:normal;margin-bottom:0;" class="MsoNormal"><span style="font-family:consolas;color:blue;font-size:9.5pt;"></span></p>
<p>&#160;</p></p>
<h2>Summary</p>
</h2>
<p class="MsoNormal">Most of the WIF integration simply works with Workflow Services without any issues and is exactly the same as code based services. If you need to access claims inside your workflows or you want to implement more advance security scenarios such as </p>
<ul>
<li>
<div class="MsoNormal">Fine grained control over token issuance and it’s usage </div>
</li>
<li>
<div class="MsoNormal">Claims-based delegation to other services </div>
</li>
</ul>
<p>You can use WF Security Pack which provides additional activities and accompanying framework code to accomplish above mentioned security scenarios. </p>
