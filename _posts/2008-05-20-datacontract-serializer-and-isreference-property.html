---
layout: post
title: DataContract Serializer and IsReference property
date: 2008-05-20 13:19:16.000000000 +05:00
type: post
published: true
status: publish
categories:
- WCF
tags: []
meta:
  _edit_last: '13661190'
  _oembed_3d667e2d940549a70caad0140a950009: '{{unknown}}'
  _oembed_0ba10cbb8d8aada10e0e216185b9186a: '{{unknown}}'
  _oembed_b7febbbad4200b03dba53e8824d2ef60: '{{unknown}}'
  _oembed_840c0c405e2a921d3edb63b18bb5ee63: '{{unknown}}'
  _oembed_5f01a6bd327bc49ba4d95d0fb32e73c1: '{{unknown}}'
  _oembed_a0db5bc018e3980e13154924fd7c3867: '{{unknown}}'
  _oembed_00478d9573c59707690118c6919ca23d: '{{unknown}}'
  _oembed_9a6a4678a334260abe66db6d7a6e6962: '{{unknown}}'
  _oembed_9251665866cc10f8f8bdf83347556cde: '{{unknown}}'
  _oembed_615dffb1aba3331757671bba78684380: '{{unknown}}'
  _oembed_98b3d1f3f8f41164cf5f92a8e38daa10: '{{unknown}}'
  _oembed_445d4339c6de6f296c9ae18761c589c7: '{{unknown}}'
  _oembed_0e41902476b9dbdcf4b61f6343f9b2ed: '{{unknown}}'
  _oembed_db67ac40ec937ef425895e9ce2ac8d03: '{{unknown}}'
  _oembed_a7215d6a3a29713a3b7cfe88eb83a349: '{{unknown}}'
  _oembed_0b503b3d4d53cc9c0146f5a7793ec968: '{{unknown}}'
  _oembed_aad3328d373edc6850cea2d23cc2f3cc: '{{unknown}}'
  _oembed_c033351142958f9be373f301cf5b6b52: '{{unknown}}'
author:
  login: zamd
  email: zulfiqar.ahmed@gmail.com
  display_name: zamd
  first_name: ''
  last_name: ''
---
<p class="MsoNormal">In .net Framework 3.5 SP1, DataContractSerializer supports by-ref object graph serialization by using the standard xsd:ID/xsd:IDREF attributes. </p>
<p class="MsoNormal">You can set the IsReference=true on your DataContract definition and serializer will generate XML elements with IDs/IDREFs attributes and will link them together rather embedding them inside each other(default behavior). </p>
<p class="MsoNormal">Also if you examine the XSD generated by WCF as part of the metadata export, it will also contain the standard ID/IDREF xml schema attributes. Because of this, xml can be correctly parsed and understood by any framework in a standard way. </p>
<p class="MsoNormal">This change will enable serialization of object graphs having circular references (which wasn’t possible previously – at least not without writing custom code) and will also reduce the size of the serialized xml. </p>
<p class="MsoNormal">Let’s examine this change using the following DataContract definition: </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    [<span style="color:#2b91af;">DataContract</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    <span style="color:blue;">public</span> <span style="color:blue;">class</span> <span style="color:#2b91af;">Employee</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    {</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        [<span style="color:#2b91af;">DataMember</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">public</span> <span style="color:blue;">string</span> Name { <span style="color:blue;">get</span>; <span style="color:blue;">set</span>; }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        [<span style="color:#2b91af;">DataMember</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">public</span> <span style="color:#2b91af;">Employee</span> Manager { <span style="color:blue;">get</span>; <span style="color:blue;">set</span>; }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    [<span style="color:#2b91af;">DataContract</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    <span style="color:blue;">public</span> <span style="color:blue;">class</span> <span style="color:#2b91af;">Department</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    {</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        [<span style="color:#2b91af;">DataMember</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">public</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">Employee</span>&gt; Staff { <span style="color:blue;">get</span>; <span style="color:blue;">set</span>; }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        [<span style="color:#2b91af;">DataMember</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">public</span> <span style="color:blue;">string</span> DeptName { <span style="color:blue;">get</span>; <span style="color:blue;">set</span>; }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    }</span> </p>
<p class="MsoNormal">Now if we serialize following Department object using DataContractSerializer </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> kenny = <span style="color:blue;">new</span> <span style="color:#2b91af;">Employee</span>() { Name = <span style="color:#a31515;">"Kenny"</span> };</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> bob = <span style="color:blue;">new</span> <span style="color:#2b91af;">Employee</span>() { Name = <span style="color:#a31515;">"Bob"</span>, Manager = kenny };</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> alice = <span style="color:blue;">new</span> <span style="color:#2b91af;">Employee</span>() { Name = <span style="color:#a31515;">"Alice"</span>, Manager = kenny };</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> ahmed = <span style="color:blue;">new</span> <span style="color:#2b91af;">Employee</span>() { Name = <span style="color:#a31515;">"Ahmed"</span>, Manager = kenny };</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;"> </span><span style="font-family:'Courier New';font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> dept = <span style="color:blue;">new</span> <span style="color:#2b91af;">Department</span>() { DeptName = <span style="color:#a31515;">"RandD"</span>, Staff = <span style="color:blue;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">Employee</span>&gt;() { kenny, bob, alice, ahmed } };</span><span style="font-family:'Courier New';font-size:10pt;">        </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:#2b91af;">DataContractSerializer</span> dcs = <span style="color:blue;">new</span> <span style="color:#2b91af;">DataContractSerializer</span>(<span style="color:blue;">typeof</span>(<span style="color:#2b91af;">Department</span>));</span><span style="font-family:'Courier New';font-size:10pt;">        </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> ms = <span style="color:blue;">new</span> <span style="color:#2b91af;">MemoryStream</span>();</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        dcs.WriteObject(ms, dept);</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        ms.Seek(0, <span style="color:#2b91af;">SeekOrigin</span>.Begin);</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;"> </span><span style="font-family:'Courier New';font-size:10pt;">        </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> sr = <span style="color:blue;">new</span> <span style="color:#2b91af;">StreamReader</span>(ms);</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">var</span> xml = sr.ReadToEnd();</span> </p>
<p class="MsoNormal">We will get this xml. </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">&lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Department</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">xmlns</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">http://schemas.datacontract.org/2004/07/ConsoleApplication2</span>"<span style="color:blue;"> </span><span style="color:red;">xmlns:i</span><span style="color:blue;">=</span>"<span style="color:blue;">http://www.w3.org/2001/XMLSchemainstance</span>"<span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">      &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">DeptName</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">RandD<span style="color:blue;">&lt;/</span><span style="color:#a31515;">DeptName</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">      &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Staff</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">i:nil</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">true</span>"<span style="color:blue;"> /&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Kenny<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                        &lt;</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">i:nil</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">true</span>"<span style="color:blue;"> /&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                        &lt;</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">Kenny<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                  &lt;/</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Bob<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                        &lt;</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">i:nil</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">true</span>"<span style="color:blue;"> /&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                        &lt;</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">Kenny<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                  &lt;/</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Alice<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                        &lt;</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">i:nil</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">true</span>"<span style="color:blue;"> /&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                        &lt;</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">Kenny<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">                  &lt;/</span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Ahmed<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">      &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Staff</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">&lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Department</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal">You can see manager Kenny is included in all Employee objects, essentially a by-value inclusion.  Now if we change the declaration of Employee class to following: </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    [<span style="color:#2b91af;">DataContract</span>(<span style="background:yellow;">IsReference = <span style="color:blue;">true</span></span>)]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    <span style="color:blue;">public</span> <span style="color:blue;">class</span> <span style="color:#2b91af;">Employee</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    {</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;"> </span><span style="font-family:'Courier New';font-size:10pt;">        [<span style="color:#2b91af;">DataMember</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">public</span> <span style="color:blue;">string</span> Name { <span style="color:blue;">get</span>; <span style="color:blue;">set</span>; }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        [<span style="color:#2b91af;">DataMember</span>]</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">        <span style="color:blue;">public</span> <span style="color:#2b91af;">Employee</span> Manager { <span style="color:blue;">get</span>; <span style="color:blue;">set</span>; }</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';font-size:10pt;">    }</span> </p>
<p class="MsoNormal">With above change, you will get following different xml. </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">&lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Department</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">xmlns</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">http://schemas.datacontract.org/2004/07/ConsoleApplication2</span>"<span style="color:blue;"> </span><span style="color:red;">xmlns:i</span><span style="color:blue;">=</span>"<span style="color:blue;">http://www.w3.org/2001/XMLSchemainstance</span>"<span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">      &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">DeptName</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">R<span style="color:red;">&amp;D</span><span style="color:blue;">&lt;/</span><span style="color:#a31515;">DeptName</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">      &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Staff</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">z:Id</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">i1</span>"<span style="color:blue;"> </span><span style="color:red;">xmlns:z</span><span style="color:blue;">=</span>"<span style="color:blue;">http://schemas.microsoft.com/2003/10/Serialization/</span>"<span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">i:nil</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">true</span>"<span style="color:blue;"> /&gt;</span></span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Kenny<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">z:Id</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">i2</span>"<span style="color:blue;"> </span><span style="color:red;">xmlns:z</span><span style="color:blue;">=</span>"<span style="color:blue;">http://schemas.microsoft.com/2003/10/Serialization/</span>"<span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">z:Ref</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">i1</span>"<span style="color:blue;"> /&gt;</span></span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Bob<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">z:Id</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">i3</span>"<span style="color:blue;"> </span><span style="color:red;">xmlns:z</span><span style="color:blue;">=</span>"<span style="color:blue;">http://schemas.microsoft.com/2003/10/Serialization/</span>"<span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">z:Ref</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">i1</span>"<span style="color:blue;"> /&gt;</span></span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Alice<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';color:red;font-size:10pt;">z:Id</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';font-size:10pt;">"<span style="color:blue;">i4</span>"<span style="color:blue;"> </span><span style="color:red;">xmlns:z</span><span style="color:blue;">=</span>"<span style="color:blue;">http://schemas.microsoft.com/2003/10/Serialization/</span>"<span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  <span style="background:yellow;">&lt;</span></span><span style="font-family:'Courier New';background:yellow;color:#a31515;font-size:10pt;">Manager</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;"> </span><span style="font-family:'Courier New';background:yellow;color:red;font-size:10pt;">z:Ref</span><span style="font-family:'Courier New';background:yellow;color:blue;font-size:10pt;">=</span><span style="font-family:'Courier New';background:yellow;font-size:10pt;">"<span style="color:blue;">i1</span>"<span style="color:blue;"> /&gt;</span></span><span style="font-family:'Courier New';color:blue;font-size:10pt;"> </span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">                  &lt;</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Name</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span><span style="font-family:'Courier New';font-size:10pt;">Ahmed<span style="color:blue;">&lt;/</span><span style="color:#a31515;">Name</span><span style="color:blue;">&gt;</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">            &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Employee</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">      &lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Staff</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;">&lt;/</span><span style="font-family:'Courier New';color:#a31515;font-size:10pt;">Department</span><span style="font-family:'Courier New';color:blue;font-size:10pt;">&gt;</span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;"><span style="font-family:Verdana;color:#003300;">In attribute-free (POCO) world:</span></span> </p>
<p class="MsoNormal"><span style="font-family:'Courier New';color:blue;font-size:10pt;"><span style="font-family:Verdana;color:#003300;">you can use a different ctor, taking a boolean flag, to toggle by-val/by-ref serialization.</span></span> </p>
<div class="Section1">      DataContractSerializer(Type type, IEnumerable&lt;Type&gt; knownTypes, int maxItemsInObjectGraph, bool ignoreExtensionDataObject, bool preserveObjectReferences, IDataContractSurrogate dataContractSurrogate)</div>
<p><span style="font-family:'Courier New';color:blue;font-size:10pt;"><span style="font-family:Verdana;color:#003300;">To enable circular references for operation or service scope, you can use custom behaviors etc. Essentially you need the ability to hook into serializer instantiation process and create the instance using above overload:</span></span> </p>
<p><span style="font-family:'Courier New';color:blue;font-size:10pt;">   <span style="font-family:Verdana;color:#003300;">1. Subclass DataContractSerializerOperationBehavior</span></span> </p>
<p><span style="font-family:'Courier New';color:blue;font-size:10pt;">   <span style="font-family:Verdana;color:#003300;">2. Ovverride CreateSerializer method</span></span> </p>
<p><span style="font-family:'Courier New';color:blue;font-size:10pt;">   <span style="font-family:Verdana;color:#003300;">3. Create a new DCS instance passing true to preserveObjectReferences param.<span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;"> </p>
<p>class<span style="color:#000000;font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">DataContractSerializerOperationBehaviorEx</span></span><span style="color:#000000;font-size:x-small;"> : </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">DataContractSerializerOperationBehavior </p>
<p></span></span><span style="font-size:x-small;">{ </p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">public</span></span><span style="font-size:x-small;"> DataContractSerializerOperationBehaviorEx(</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">OperationDescription</span></span><span style="font-size:x-small;"> operation):</span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">base</span></span><span style="font-size:x-small;">(operation) </p>
<p>{ </p>
<p>} </p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">public</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">override</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">XmlObjectSerializer</span></span><span style="font-size:x-small;"> CreateSerializer(</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Type</span></span><span style="font-size:x-small;"> type, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">string</span></span><span style="font-size:x-small;"> name, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">string</span></span><span style="font-size:x-small;"> ns, </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">IList</span></span><span style="font-size:x-small;">&lt;</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Type</span></span><span style="font-size:x-small;">&gt; knownTypes) </p>
<p>{ </p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">return</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">new</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">DataContractSerializer</span></span><span style="font-size:x-small;">(type, name, ns, knownTypes, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">this</span></span><span style="font-size:x-small;">.MaxItemsInObjectGraph, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">this</span></span><span style="font-size:x-small;">.IgnoreExtensionDataObject, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">true</span></span><span style="font-size:x-small;">, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">this</span></span><span style="font-size:x-small;">.DataContractSurrogate); </p>
<p>} </p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">public</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">override</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">XmlObjectSerializer</span></span><span style="font-size:x-small;"> CreateSerializer(</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Type</span></span><span style="font-size:x-small;"> type, System.Xml.</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">XmlDictionaryString</span></span><span style="font-size:x-small;"> name, System.Xml.</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">XmlDictionaryString</span></span><span style="font-size:x-small;"> ns, </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">IList</span></span><span style="font-size:x-small;">&lt;</span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">Type</span></span><span style="font-size:x-small;">&gt; knownTypes) </p>
<p>{ </p>
<p><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">return</span></span><span style="font-size:x-small;"> </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">new</span></span><span style="font-size:x-small;"> </span><span style="color:#2b91af;font-size:x-small;"><span style="color:#2b91af;font-size:x-small;">DataContractSerializer</span></span><span style="font-size:x-small;">(type, name, ns, knownTypes, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">this</span></span><span style="font-size:x-small;">.MaxItemsInObjectGraph, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">this</span></span><span style="font-size:x-small;">.IgnoreExtensionDataObject, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">true</span></span><span style="font-size:x-small;">, </span><span style="color:#0000ff;font-size:x-small;"><span style="color:#0000ff;font-size:x-small;">this</span></span><span style="font-size:x-small;">.DataContractSurrogate); </p>
<p>} </p>
<p>} </p>
<p></span></p>
<p></span></p>
<p></span></p>
<p></span></p>
<p></span></p>
<p></span></p>
<p></span></span></span></span></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p></p>
