---
layout: post
title: Setting ProtectionLevel from config file
date: 2008-02-10 22:34:23.000000000 +05:00
type: post
published: true
status: publish
categories:
- WCF
tags: []
meta:
  _edit_last: '13661190'
author:
  login: zamd
  email: zulfiqar.ahmed@gmail.com
  display_name: zamd
  first_name: ''
  last_name: ''
---
<div class="Section1">
<p class="MsoNormal"><a href="http://msdn2.microsoft.com/en-us/library/aa347692.aspx">Protectionlevel</a> enum defines the level of security in terms of encryption &amp; signature. When programing at the Service Model layer, ProtectionLevel can be set at various levels: </p>
<p class="MsoListParagraph" style="margin-left:.75in;text-indent:-.25in;"><span style="font-family:Symbol;"><span>·<span style="font:7pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>ServiceContract level: all messages/faults of a service contract will have same protection level </p>
<p class="MsoListParagraph" style="margin-left:.75in;text-indent:-.25in;"><span style="font-family:Symbol;"><span>·<span style="font:7pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>OperationContract level: An operation can override the protection level specified at the contract level. So messages/faults of an operation can have different protection requirements. </p>
<p class="MsoListParagraph" style="margin-left:.75in;text-indent:-.25in;"><span style="font-family:Symbol;"><span>·<span style="font:7pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>MessageContract level: Individual messages/faults can also specify their own protection level, overriding the one specified at higher level.</p>
<p class="MsoNormal">If your only requirement is to be able to set protection level from config file, then a simple option could be to access the description object model and update the contract protection level there before opening the service host or proxy.<span style="color:#1f497d;"></span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ServiceHost</span><b><span style="font-size:10pt;font-family:'Courier New';"> svc = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ServiceHost</span><b><span style="font-size:10pt;font-family:'Courier New';">(</span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">typeof</span><b><span style="font-size:10pt;font-family:'Courier New';">(CalculatorService));</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;font-family:'Courier New';">svc.Description.Endpoints[0].Contract.ProtectionLevel = GetProtectionLevelFromConfig();</span><span style="color:#1f497d;"></span></p>
<p class="MsoNormal">If however, you want to set different protection level for different endpoints, then you have to do some more work. </p>
<p class="MsoNormal">Specifically you have to create an endpoint behavior, from which you will access the ChannelProtectionRequirements parameter to specify endpoint specific protection requirements. Here is step by step procedure to do this:</p>
<p class="MsoListParagraph" style="margin-left:.75in;text-indent:-.25in;"><span style="color:#1f497d;"><span>1.<span style="font:7pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Create an endpoint behavior and add following code to AddBindingParameters method.<span style="color:#1f497d;"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">class</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ProtectionLevelBehavior</span><b><span style="font-size:10pt;font-family:'Courier New';"> : </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">IEndpointBehavior</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ProtectionLevel level;</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:'Courier New';">&nbsp;</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">internal</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevelBehavior(ProtectionLevel level)</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">this</span><span style="font-size:10pt;font-family:'Courier New';">.level = level;</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region</span><b><span style="font-size:10pt;font-family:'Courier New';"> IEndpointBehavior Members</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:'Courier New';">&nbsp;</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">void</span><b><span style="font-size:10pt;font-family:'Courier New';"> AddBindingParameters(</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ServiceEndpoint</span><b><span style="font-size:10pt;font-family:'Courier New';"> endpoint, System.ServiceModel.Channels.</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">BindingParameterCollection</span><b><span style="font-size:10pt;font-family:'Courier New';"> bindingParameters)</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">var</span><b><span style="font-size:10pt;font-family:'Courier New';"> proReq =</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingParameters.Remove&lt;</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ChannelProtectionRequirements</span><span style="font-size:10pt;font-family:'Courier New';">&gt;();</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ChannelProtectionRequirements</span><b><span style="font-size:10pt;font-family:'Courier New';">();</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">MessagePartSpecification</span><b><span style="font-size:10pt;font-family:'Courier New';"> unProtectedSpec = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">MessagePartSpecification</span><b><span style="font-size:10pt;font-family:'Courier New';">();</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">MessagePartSpecification</span><b><span style="font-size:10pt;font-family:'Courier New';"> protectedSpec = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">MessagePartSpecification</span><b><span style="font-size:10pt;font-family:'Courier New';">(</span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">true</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:green;font-family:'Courier New';">//I'm setting same protection level for all the actions.</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:green;font-family:'Courier New';">// You could specify different protection level per action, if required. </span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:green;font-family:'Courier New';">// Also note, I haven't implemented any support for custom SOAP headers.</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:green;font-family:'Courier New';">// However that can easily be added using the same mechansim.</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">switch</span><b><span style="font-size:10pt;font-family:'Courier New';"> (level)</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">case</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevel.None:</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.OutgoingSignatureParts.AddParts(unProtectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.IncomingSignatureParts.AddParts(unProtectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.OutgoingEncryptionParts.AddParts(unProtectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.IncomingEncryptionParts.AddParts(unProtectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">break</span><b><span style="font-size:10pt;font-family:'Courier New';">;</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">case</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevel.Sign:</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.OutgoingSignatureParts.AddParts(protectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.IncomingSignatureParts.AddParts(protectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.OutgoingEncryptionParts.AddParts(unProtectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.IncomingEncryptionParts.AddParts(unProtectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">break</span><b><span style="font-size:10pt;font-family:'Courier New';">;</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">case</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevel.EncryptAndSign:</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.OutgoingSignatureParts.AddParts(protectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.IncomingSignatureParts.AddParts(protectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.OutgoingEncryptionParts.AddParts(protectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proReq.IncomingEncryptionParts.AddParts(protectedSpec, </span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"*"</span><b><span style="font-size:10pt;font-family:'Courier New';">);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">break</span><b><span style="font-size:10pt;font-family:'Courier New';">;</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:green;font-family:'Courier New';">// Add our protection requirement for this endpoint into the binding params.</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bindingParameters.Add(proReq);</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">void</span><b><span style="font-size:10pt;font-family:'Courier New';"> ApplyClientBehavior(</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ServiceEndpoint</span><b><span style="font-size:10pt;font-family:'Courier New';"> endpoint, System.ServiceModel.Dispatcher.</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ClientRuntime</span><b><span style="font-size:10pt;font-family:'Courier New';"> clientRuntime)</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">void</span><b><span style="font-size:10pt;font-family:'Courier New';"> ApplyDispatchBehavior(</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ServiceEndpoint</span><b><span style="font-size:10pt;font-family:'Courier New';"> endpoint, System.ServiceModel.Dispatcher.</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">EndpointDispatcher</span><b><span style="font-size:10pt;font-family:'Courier New';"> endpointDispatcher)</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">void</span><b><span style="font-size:10pt;font-family:'Courier New';"> Validate(</span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ServiceEndpoint</span><b><span style="font-size:10pt;font-family:'Courier New';"> endpoint)</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp; }</span></b><span style="color:#1f497d;"></span></p>
<p class="MsoListParagraph" style="margin-left:.75in;text-indent:-.25in;"><span style="color:#1f497d;"><span>2.<span style="font:7pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:12pt;">Now create a behavior extension so that this behavior can be enabled/disabled using configuration file. The behavior extension will read the configured protectionLevel from config file and will create an instance of above endpoint behavior to plug it into behavior collections.</span><span style="color:#1f497d;"></span></p>
<p class="MsoNormal" style="margin-left:.5in;"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:green;font-family:'Courier New';">//behavior configuration extension element</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">class</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">ProtectionLevelBehaviorElement</span><b><span style="font-size:10pt;font-family:'Courier New';"> : BehaviorExtensionElement</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevelBehaviorElement()</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">override</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:#2b91af;font-family:'Courier New';">Type</span><b><span style="font-size:10pt;font-family:'Courier New';"> BehaviorType</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">get</span><b><span style="font-size:10pt;font-family:'Courier New';"> { </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">return</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">typeof</span><b><span style="font-size:10pt;font-family:'Courier New';">(ProtectionLevelBehavior); }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><span style="font-size:10pt;font-family:'Courier New';">&nbsp;</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">protected</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">override</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">object</span><b><span style="font-size:10pt;font-family:'Courier New';"> CreateBehavior()</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">return</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevelBehavior(</span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">this</span><span style="font-size:10pt;font-family:'Courier New';">.Level);</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [ConfigurationProperty(</span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"level"</span><b><span style="font-size:10pt;font-family:'Courier New';">)]</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">public</span><b><span style="font-size:10pt;font-family:'Courier New';"> ProtectionLevel Level</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">get</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">return</span><b><span style="font-size:10pt;font-family:'Courier New';"> (ProtectionLevel)</span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">base</span><b><span style="font-size:10pt;font-family:'Courier New';">[</span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"level"</span><b><span style="font-size:10pt;font-family:'Courier New';">];</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">set</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">base</span><b><span style="font-size:10pt;font-family:'Courier New';">[</span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"level"</span><b><span style="font-size:10pt;font-family:'Courier New';">] = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">value</span><b><span style="font-size:10pt;font-family:'Courier New';">;</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConfigurationPropertyCollection properties = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">null</span><b><span style="font-size:10pt;font-family:'Courier New';">;</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">protected</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">override</span><b><span style="font-size:10pt;font-family:'Courier New';"> ConfigurationPropertyCollection Properties</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">get</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">if</span><b><span style="font-size:10pt;font-family:'Courier New';"> (</span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">this</span><span style="font-size:10pt;font-family:'Courier New';">.properties == <span style="color:blue;">null</span><b>)</b></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConfigurationPropertyCollection propertys = </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> ConfigurationPropertyCollection();</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; propertys.Add(</span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">new</span><b><span style="font-size:10pt;font-family:'Courier New';"> ConfigurationProperty(</span></b><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">"level"</span><b><span style="font-size:10pt;font-family:'Courier New';">, </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">typeof</span><b><span style="font-size:10pt;font-family:'Courier New';">(ProtectionLevel), </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">null</span><b><span style="font-size:10pt;font-family:'Courier New';">, ConfigurationPropertyOptions.IsRequired));</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">this</span><span style="font-size:10pt;font-family:'Courier New';">.properties = propertys;</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">return</span><b><span style="font-size:10pt;font-family:'Courier New';"> </span></b><span style="font-size:10pt;color:blue;font-family:'Courier New';">this</span><span style="font-size:10pt;font-family:'Courier New';">.properties;</span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="font-size:10pt;font-family:'Courier New';"></span></p>
<p class="MsoNormal"><b><span style="font-size:10pt;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></b><span style="color:#1f497d;"></span></p>
<p class="MsoListParagraph" style="margin-left:.75in;text-indent:-.25in;text-align:justify;"><span style="font-size:12pt;color:#1f497d;"><span>3.<span style="font:7pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:12pt;">And this is how you will specify the protection level from config file using the above behavior extension.<span style="color:#1f497d;"></span></span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp; &lt;</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">behaviors</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">&gt;</span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">endpointBehaviors</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">&gt;</span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">behavior</span><span style="font-size:10pt;color:blue;font-family:'Courier New';"> </span><span style="font-size:10pt;color:red;font-family:'Courier New';">name</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">=</span><span style="font-size:10pt;font-family:'Courier New';">"<span style="color:blue;">endpointSecurityConfig</span>"<span style="color:blue;">&gt;</span></span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">protectionLevel</span><span style="font-size:10pt;color:blue;font-family:'Courier New';"> </span><span style="font-size:10pt;color:red;font-family:'Courier New';">level</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">=</span><span style="font-size:10pt;font-family:'Courier New';">"<span style="color:blue;">Sign</span>"<span style="color:blue;">/&gt;</span></span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!--</span><span style="font-size:10pt;color:green;font-family:'Courier New';"> None, Sign, EncryptAndSign</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">--&gt;</span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">behavior</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">&gt;</span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp;&nbsp;&nbsp; &lt;/</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">endpointBehaviors</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">&gt;</span></p>
<p class="MsoNormal" style="margin-left:.5in;"><span style="font-size:10pt;color:blue;font-family:'Courier New';">&nbsp; &lt;/</span><span style="font-size:10pt;color:#a31515;font-family:'Courier New';">behaviors</span><span style="font-size:10pt;color:blue;font-family:'Courier New';">&gt;</span><span style="color:#1f497d;"></span></p>
<p class="MsoNormal"><span style="font-size:12pt;">I have attached the source code with this post. Feel free to download and reuse.</span></p>
</div>
<p>Download: <a href="http://cid-724b6fcd63a8c1ac.skydrive.live.com/self.aspx/zamd.net/protectionlevelsample.zip">protectionlevelsample.zip</a></p>
