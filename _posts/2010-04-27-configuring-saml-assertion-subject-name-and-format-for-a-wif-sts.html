---
layout: post
title: Configuring SAML Assertion Subject Name and Format for a WIF STS
date: 2010-04-27 20:38:18.000000000 +05:00
type: post
published: true
status: publish
categories:
- WIF
tags: []
meta:
  _oembed_a0ef39906fd59676a552de0a09f5fb61: '{{unknown}}'
  _oembed_1ae3c90da356e67e1132a4fc91002a1c: '{{unknown}}'
  _oembed_f4a2578df36312d6306328dcfb32c279: '{{unknown}}'
  _oembed_0d0ef3bb6bc23c146617beda30ea46a6: '{{unknown}}'
  _oembed_8f8c1d23beca7ba660be5679b4a2f580: '{{unknown}}'
  _oembed_4399f959a978290cfbfd5c3c664fa56d: '{{unknown}}'
  _oembed_0eab87f247cf3fd57c080e3c363c19dd: '{{unknown}}'
author:
  login: zamd
  email: zulfiqar.ahmed@gmail.com
  display_name: zamd
  first_name: ''
  last_name: ''
---
<p class="MsoNormal">In some interop scenarios, subject name and its format needs to be included in the Saml token/assertion generated by the STS. You can easily configure a WIF based STS to generate this by adding a NameIdentifier claim and by settings itâ€™s format property.</p>
<p class="MsoNormal"><span style="font-family:&quot;color:blue;font-size:12pt;">protected</span><span style="font-family:&quot;font-size:12pt;"> <span style="color:blue;">override</span> <span style="color:#2b91af;">IClaimsIdentity</span> GetOutputClaimsIdentity(<span style="color:#2b91af;">IClaimsPrincipal</span> principal,</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160; </span><span style="color:#2b91af;">RequestSecurityToken</span> request, <span style="color:#2b91af;">Scope</span> scope)</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;">{</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160; </span><span style="background:yellow;color:blue;">var</span><span style="background:yellow;"> nameIdentifierClaim = <span style="color:blue;">new</span> <span style="color:#2b91af;">Claim</span>(<span style="color:#2b91af;">ClaimTypes</span>.NameIdentifier, <span style="color:#a31515;">&quot;me@zamd.com&quot;</span>);</span></p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160; </span><span style="background:yellow;">nameIdentifierClaim.Properties[<span style="color:#2b91af;">ClaimProperties</span>.SamlNameIdentifierFormat] = <span style="color:#a31515;">&quot;EMAIL&quot;</span>;</span></p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;">
<p>&#160;</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160; </span><span style="color:blue;">return</span> <span style="color:blue;">new</span> <span style="color:#2b91af;">ClaimsIdentity</span>(</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">new</span> <span style="color:#2b91af;">Claim</span>[]</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>{</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color:blue;">new</span> <span style="color:#2b91af;">Claim</span>(System.IdentityModel.Claims.<span style="color:#2b91af;">ClaimTypes</span>.Name, <span style="color:#a31515;">&quot;Zulfiqar&quot;</span>),</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="background:yellow;">nameIdentifierClaim</span></p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;"><span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span>});</p>
<p>   </span></p>
<p class="MsoNormal"><span style="font-family:&quot;font-size:12pt;">
<p>&#160;</p>
<p>   </span></p>
<p class="MsoNormal">This generates following Saml Assertion where you can see the generated NameIdentifier &amp; format attribute.</p>
<pre><pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;"> <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">AttributeStatement</span> <span style="color:#ff0000;">xmlns</span>:<span style="color:#ff0000;">saml</span>=<span style="color:#0000ff;">&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot;</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">   <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">Subject</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">    <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">NameIdentifier</span> <span style="color:#ff0000;">Format</span>=<span style="color:#0000ff;">&quot;EMAIL&quot;</span><span style="color:#0000ff;">&gt;</span>me@zamd.com<span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">NameIdentifier</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">     <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">SubjectConfirmation</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">      <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">ConfirmationMethod</span><span style="color:#0000ff;">&gt;</span>urn:oasis:names:tc:SAML:1.0:cm:bearer<span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">ConfirmationMethod</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">    <span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">SubjectConfirmation</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">  <span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">Subject</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">   <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">Attribute</span> <span style="color:#ff0000;">AttributeName</span>=<span style="color:#0000ff;">&quot;name&quot;</span> <span style="color:#ff0000;">AttributeNamespace</span>=<span style="color:#0000ff;">&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims&quot;</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">    <span style="color:#0000ff;">&lt;</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">AttributeValue</span><span style="color:#0000ff;">&gt;</span>Zulfiqar<span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">AttributeValue</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;">  <span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">Attribute</span><span style="color:#0000ff;">&gt;</span>
</pre>
<pre style="background-color:#ffffff;width:100%;font-family:consolas,&#039;font-size:12px;margin:0;"><span style="color:#0000ff;">&lt;/</span><span style="color:#c71585;">saml</span>:<span style="color:#800000;">AttributeStatement</span><span style="color:#0000ff;">&gt;</span></pre>
